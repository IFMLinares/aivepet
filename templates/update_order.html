{% extends 'base/base.html' %}
{% block title %}

{% load humanize %}
Dashboard
{% endblock %}
{% load static %}
{% block extra_css %}
<!-- <link rel="stylesheet" href="{% static 'css/style.css' %}"> -->
<link rel="stylesheet" href="{% static 'vendors/select2/select2.min.css' %}">
<link rel="stylesheet" href="{% static 'vendors/select2-bootstrap-theme/select2-bootstrap.min.css' %}">
{% endblock %}
{% block content %}
<div class="col-12 grid-margin">
    <div class="card">
        <div class="card-body">
            <h2 class="text-center">Seguimiento de la orden</h2>
            <p class="card-description text-center">
                Información de carga:
            </p>
            <!-- {{ form.as_p }} -->
            <form class="form-sample" id="form-submit" method="post" action="">
                {% csrf_token %}
                {% if form.errors %}
                {% for field in form %}
                {% for error in field.errors %}
                <div class="alert alert-error">
                    <strong>{{ error|escape }}</strong>
                </div>
                {% endfor %}
                {% endfor %}
                {% for error in form.non_field_errors %}
                <div class="alert alert-error">
                    <strong>{{ error|escape }}</strong>
                </div>
                {% endfor %}
                {% endif %}
                <div class="row rounded border border-secondary ml-xl-1 mr-xl-1 mb-xl-3" style="background-color: #F5F7FF;">
                    <div class="col-md-6 mt-xl-3">
                        <h3 class="mb-xl-4">Tipo de orden: <span style="color: #51A351;"> {{ orden.order_type|title }}</span></h3>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <label for="id_state" class="mt-xl-4 mr-xl-3 ml-xl-3">Estado de la orden:</label>
                            <select class="custom-select add-order mt-xl-3 mr-xl-3" id="id_state" name="state"
                                style="width: 50%;">
                                <option value="Aceptado" {% if orden.state == 'Aceptado' %} selected {% endif %}>Aceptado
                                </option>
                                <option value="Nominado" {% if orden.state == Nominado %} selected {% endif %} disabled>
                                    Nominado</option>
                                <option value="En operación" {% if orden.state == 'En operación' %} selected {% endif %}>
                                    En operación</option>
                                <option value="Finalizado" {% if orden.state == 'Finalizado' %} selected {% endif %}>
                                    Finalizado</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Número de Orden:
                                <b>000{{ orden.id }}</b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Número de referencia (Cliente):
                                <b>{{ orden.number_invoice_client }}</b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Número de referencia (Aivepet):
                                <b>{{ orden.number_invoice_aivepet }}</b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Proveedor:
                                <b>{{ orden.customer_name.company_name }}</b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Nombre del buque: <b>{{ orden.buque_name }}</b></div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Nombre del puerto: <b>{{ orden.port_name }}</b></div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <label class="col-sm-12 col-form-label">Número del muelle: <b>{{ orden.numero_muelle }}</b></label>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Unidad de medida:
                                <b>{{ orden.unit_measurement }}</b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Cliente Suplidor:
                                <b>
                                    <ul>
                                        <li> 
                                            <span>
                                                Empresa: {{ orden.company_name }} <br>
                                                Responsable: {{ orden.name }} <br />
                                                Nro de Identificación: {% if orden.dni  %}{{ orden.dni }} {% else %}  N/A {% endif %} <br />
                                                </span>
                                        </li>
                                    </ul>
                                </b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            {{ form.receiving_customer }}
                            <div class="col-sm-12 col-form-label">Clientes recibidores:
                                <b>
                                    <ul>
                                        {% for customer in orden.receiving_customer.all %}
                                            <li> 
                                                <span
                                                    >Empresa: {{ customer.company_name|title }} <br />
                                                    Responsable: {{ customer.name|title }} {{ customer.last_name|title }} <br />
                                                    {% if orden.order_type == 'carga' %} Cargado: {{ customer.quantity|floatformat:3|intcomma }}  (TM) 
                                                    {% else %} Descargado: {{ customer.quantity|floatformat:3|intcomma }}  (TM) 
                                                    {% endif %}
                                                </span>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </b>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Productos:
                                <ul>
                                    {% for product in orden.product.all %}
                                        <li>
                                            <b>{{ product.product_id.name|title }} (TM) .</b>
                                            <br>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Cantidades:
                                <ul>
                                    {% for product in orden.product.all %}
                                        <li>
                                            <b>{{ product.weight|floatformat:3|intcomma }} (TM) .</b>
                                            <br>
                                        </li>
                                    {% endfor %}
                                    <li>
                                        <strong>Cantidad total: {{ orden.total_product_weight|floatformat:3|intcomma }}  (TM) .</strong>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 pl-xl-5">
                        <div class="form-group row">
                            <div class="col-sm-12 col-form-label">Fecha de registro:
                                <b>{{ orden.start_date }}</b>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-7">
                        <div class="border border-secondary rounded">
                            <div class="col-md-12">
                                <h2 class="mt-xl-2 text-center mb-xl-4">Estatus del buque:</h2>
                                <!-- <h3 class="mb-xl-4">Pesada: </h3> -->
                                <div class="col-md-12">
                                    
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Añadir nuevo estatus:</label>
                                        <div class="col-sm-5">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            <input type="text" class="form-control add-order" id="status_new">
                                        </div>
                                        <div class="col-sm-3 mt-xl-1">
                                            <button class="btn btn-sm btn-success mr-xl-4 mt-xl-1 {% if orden.bl %} disabled {% endif %}" type="button"
                                                    id="status_Add">Añadir</button>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Estado:</label>
                                        <div class="col-sm-7">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            <select class="custom-select add-order mt-xl-2" id="status_select">
                                                <option value="ARRIBO">ARRIBO</option>
                                                <option value="BUQUE FONDEADO (ANCLO)">BUQUE FONDEADO (ANCLO)</option>
                                                <option value="INICIO DE {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}">INICIO DE {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}</option>
                                                <option value="FIN DE {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}">FIN DE {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}</option>
                                                <option value="SUSPENCIÓN DE LA {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}">SUSPENCIÓN DE LA {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}</option>
                                                <option value="REANUDACIÓN DE LA {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}">REANUDACIÓN DE LA {% if orden.order_type == 'carga' %} CARGA {% else %}DESCARGA{% endif %}</option>
                                                <option value="ATRACADO">ATRACADO</option>
                                                <option value="FINALIZA LA INSPECCIÓN INICIAL">FINALIZA LA INSPECCIÓN INICIAL</option>
                                                <option value="FINALIZA LA INSPECCIÓN FINAL">FINALIZA LA INSPECCIÓN FINAL</option>
                                                <option value="FINALIZA CALCULOS">FINALIZA CÁLCULOS</option>
                                                <option value="PAUSADO">PAUSADO</option>
                                                {% for status in status.all %}
                                                <option value="{{ status.status }}">{{ status.status }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Fecha:</label>
                                        <div class="col-sm-7">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            <input type="datetime-local" class="form-control add-order" id="status_date">
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Evento:</label>
                                        <div class="col-sm-7">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            <textarea class="form-control" id="status_comment"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-12 text-right">
                                        <div class="form-group row">
                                            <div class="col-sm-12">
                                                <button class="btn btn-sm btn-success mr-xl-4" type="button"
                                                    id="status_button">Actualizar estado</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div class="col-md-12">
                                <h2 class="mt-xl-2 text-center mb-xl-4">Información del buque:</h2>
                                <div class="col-md-12">
                                    <div class="form-group row">
                                        <!-- <label class="col-md-4 col-form-label">Bill of Lading (BL):</label>
                                        <div class="col-sm-5">
                                            
                                            <input type="text" class="form-control add-order mt-xl-2"
                                                placeholder="BL del buque" name="bl1" id="id_bl1" {% if orden.bl %} value="{{ orden.bl }}" disabled {% endif %}>
                                                <input type="number" class="form-control add-order mt-xl-2 d-none"
                                                placeholder="BL del buque" name="bl" id="id_bl" {% if orden.bl %} value="{{ orden.bl }}" disabled {% endif %}>
                                        </div>
                                        <div class="col-sm-3 mt-xl-2">
                                             (TM) 
                                        </div> -->
                                        <div class="col-md-12">
                                            <div class="form-group row">
                                                <label class="col-md-4 col-form-label"> <strong>{% if orden.order_type == 'descarga' %} Draft puerto de carga{% else %} Cantidad nominada: {% endif %}</strong></label>
                                                <div class="col-sm-5">
                                                    <input type="text" class="form-control add-order" id="cant_carg1" name="cant_carg1" placeholder="Monto del draft final" value="{% if orden.order_type == 'descarga' %} {{ orden.total_product_weight|floatformat:3|intcomma }} {% else %} {{ orden.cant_carg|floatformat:3|intcomma }} {% endif %}" {% if orden.cant_carg == 0 %} {% else %}disabled {% endif %}>
                                                    <input type="text" class="form-control add-order d-none" id="cant_carg" name="cant_carg" placeholder="Monto del puerto de carga" value="{{ orden.cant_carg }}"  {% if orden.cant_carg and orden.cant_carg == 0 %}{% else %}readonly {% endif %}>
                                                </div>
                                                <div class="col-sm-3 mt-xl-1">
                                                     (TM) 
                                                </div>
                                                 
                                                <div class="col-12">
                                                    <button class="btn btn-sm btn-success mr-xl-4 mt-xl-1 float-right " type="button"
                                                    id="add-cant-cargada">Añadir</button>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-12">
                                            <div class="form-group row">
                                                <label class="col-md-4 col-form-label"> <strong> Draft Inicial {% if orden.order_type == 'descarga' %}  +  {% endif %} (Constante) </strong></label>
                                                <div class="col-sm-5">
                                                    <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                                    <input type="text" class="form-control add-order mt-xl-2"
                                                        placeholder="Draft del buque" name="draft1" id="id_draft1" {% if orden.draft %} disabled value="{{ orden.draft|floatformat:3|intcomma }}" {% endif %}>
                                                        <input type="text" class="form-control add-order mt-xl-2 d-none"
                                                        placeholder="Draft del buque" name="draft" id="id_draft" {% if orden.draft %} disabled value="{{ orden.draft }}" {% endif %}>
                                                </div>
                                                <div class="col-sm-3 mt-xl-2">
                                                     (TM) 
                                                </div>
                                                
                                                <div class="col-12">
                                                    <button class="btn btn-sm btn-success mr-xl-4 mt-xl-1 {% if orden.draft %} disabled {% endif %} float-right" type="button"
                                                    id="add_draft">Añadir</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-12">
                                            <div class="form-group row">
                                                <label class="col-md-4 col-form-label"> <strong> Draft Final:</strong></label>
                                                <div class="col-sm-5">
                                                    <input type="text" class="form-control add-order" id="final_draft1" name="final_draft1" placeholder="Monto del draft final" value="{{ orden.final_draft|floatformat:3|intcomma }}" {% if orden.final_draft == '0' %} {% else %}disabled {% endif %}>
                                                    <input type="text" class="form-control add-order d-none" id="final_draft" name="final_draft" placeholder="Monto del draft final" value="{{ orden.final_draft }}"  {% if orden.final_draft and orden.final_draf == 0 %}{% else %}readonly {% endif %}>
                                                </div>
                                                <div class="col-sm-3 mt-xl-1">
                                                     (TM) 
                                                </div>
                                                
                                                <div class="col-12">
                                                    <button class="btn btn-sm btn-success mr-xl-4 mt-xl-1 float-right" type="button"
                                                    id="add_final_draft">Añadir</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-12">
                                        <div class="form-group row">
                                            <label class="col-md-4 col-form-label"> <strong> {% if orden.order_type == 'carga' %}  Cantidad Cargada {% else %} Cantidad a bordo  {% endif %} </strong></label>
                                            <div class="col-sm-5">
                                                <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                                <input type="text" class="form-control add-order mt-xl-2"
                                                    placeholder="Draft del buque" name="new_qan1" id="id_new_qan1" readonly {% if orden.new_qan %} readonly value="{{ orden.new_qan|floatformat:3|intcomma }}" {% endif %}>
                                                    <input type="text" class="form-control add-order mt-xl-2 d-none"
                                                    placeholder="Draft del buque" name="new_qan" id="id_new_qan" readonly {% if orden.new_qan %} value="{{ orden.new_qan }}" {% endif %}>
                                            </div>
                                            <div class="col-sm-3 mt-xl-2">
                                                 (TM) 
                                            </div>
                                        </div>
                                    </div> 
                                    <hr>
                                    <h2 class="mt-xl-2 text-center mb-xl-4">Bill of Lading:</h2>
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Añadir BL:</label>
                                        <div class="col-sm-5">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            <input type="text" class="form-control add-order mt-xl-2"
                                                placeholder="BL del buque" id="id_bl_multiple" {% if orden.bl %} disabled {% endif %}>
                                        </div>
                                        <label class="col-md-4 col-form-label">Producto:</label>
                                        <div class="col-sm-5">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            
                                            <select class="custom-select add-order mt-xl-2" id="id_bl_product">
                                                {% for product in orden.product.all %}
                                                <option value="{{ product.product_id.pk|title }}">{{ product.product_id.name|title }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <label class="col-md-4 col-form-label">Cliente Recibidor:</label>
                                        <div class="col-sm-5">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            
                                            <select class="custom-select add-order mt-xl-2" id="id_bl_customer">
                                                {% for customer in orden.receiving_customer.all %}
                                                <option value="{{ customer.pk }}">{{ customer.company_name|title }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-sm-3 mt-xl-1">
                                            <button class="btn btn-sm btn-success mr-xl-4 mt-xl-1 {% if orden.bl %} disabled {% endif %}" type="button"
                                                    id="multiple_bl">Añadir</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group row text-center" style="color: darkgray;">
                                        Nota: El campo Bill of Lading (BL): se guardará al actualizar la orden, si esta misma posee mas de un BL debe ingresar el bill of lading total y añadir los multiples en la seccion de multiples BL
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="border border-secondary rounded">
                            <div class="col-md-12">
                                <h2 class="mt-xl-4 text-center mb-xl-4">Plan de {% if orden.order_type == 'descarga' %} descarga{% else %} carga {% endif %}:</h2>
                                <!-- <h3 class="mb-xl-4">Pesada: </h3> -->
                            </div>
                            <hr>
                            <div class="row ml-xl-3">
                                <div class="col-md-12">
                                    <h4 class="mb-xl-4 mt-xl-2">Bodegas:</h4>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Producto:</label>
                                        <div class="col-sm-7">
                                            <!-- <input type="text" class="form-control add-order" placeholder="bodega del barco, de dónde procede el producto" name="Wineries" id="id_Wineries"> -->
                                            <select class="custom-select add-order mt-xl-2" id="bodega_product">
                                                {% for product in orden.product.all %}
                                                <option value="{{ product.product_id.pk }}">{{ product.product_id.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Peso:</label>
                                        <div class="col-md-7">
                                            <input type="text" class="form-control mt-xl-2" placeholder="5000"
                                                id="bodega_peso" style=" height: 68%;">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3 mt-xl-1">
                                      (TM) 
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group row">
                                        <label class="col-md-4 col-form-label">Bodega:</label>
                                        <div class="col-md-7">
                                            <input type="text" class="form-control mt-xl-2" placeholder="Bodega/Nro"
                                                id="bodega_nueva" style="padding-left:  10%; height: 68%;">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group row mt-xl-1">
                                        <div class="col-sm-12 pt-xl-2">
                                            <button class="btn btn-sm btn-success" type="button"
                                                id="bodega_nueva_button">Añadir</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="border border-secondary rounded mt-xl-3">
                            <div class="col-md-12">
                                <h2 class="mt-xl-2 text-center mb-xl-4">Destinos de la orden</h2>
                                <!-- <h3 class="mb-xl-4">Pesada: </h3> -->
                            </div>
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li>Puerto destino:</li>
                                    </label>
                                    <div class="col-sm-5">
                                        <input type="text" class="form-control add-order" id="destino_input" placeholder="Dirección del puerto">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li>Producto:</li>
                                    </label>
                                    <div class="col-sm-4">
                                        <select class="custom-select add-order mt-xl-2" id="destiny_product">
                                            {% for product in orden.product.all %}
                                            <option value="{{ product.product_id.pk }}">{{ product.product_id.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li>Cliente Recibidor:</li>
                                    </label>
                                    <div class="col-sm-4">
                                        <select class="custom-select add-order mt-xl-2" id="destiny_customer">
                                            {% for customer in orden.receiving_customer.all %}
                                            <option value="{{ customer.pk }}">{{ customer.company_name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-sm-4">
                                        <button class="btn btn-sm btn-success mt-xl-1" type="button"
                                            id="destino_button">Añadir
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="border border-secondary rounded mt-xl-3">
                            <div class="col-md-12">
                                <h2 class="mt-xl-2 text-center mb-xl-4">Información del transporte</h2>
                                <input type="hidden" id="transaction_id" value="{{ orden.pk }}">
                                <!-- <h3 class="mb-xl-4">Pesada: </h3> -->
                            </div>
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li>Cliente Recibidor:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <select class="custom-select add-order mt-xl-2" id="id_transport_customer">
                                            {% for customer in orden.receiving_customer.all %}
                                            <option value="{{ customer.pk }}">{{ customer.company_name|title }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>

                                
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li>Bodega:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <select class="custom-select add-order mt-xl-2" id="id_bodega_transport">
                                            {% if orden.Wineries.all %}
                                            {% for winerie in orden.Wineries.all %}
                                            <option value="{{ winerie.pk }}">{{ winerie.product.name|upper }}. <strong>Bdga/ALM :</strong> {{ winerie.number|title }}:</option>
                                            {% endfor %}
                                        {% endif %}
                                        </select>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li>Tipo de transporte:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <select class="custom-select add-order mt-xl-2" id="id_vehicle" name="vehicle">
                                            <option value="Volqueta">Volqueta (Tipo volteo)</option>
                                        </select>
                                        <!-- <input type="text" class="form-control add-order" name=""
                                            id=""> -->
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Placa:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="license_plate"
                                            id="id_license_plate" placeholder="Placa del vehículo">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Placa de la volqueta:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="tank_plate"
                                            id="id_tank_plate" placeholder="En caso de no aplicar deje vacío o escriba N/A">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Nombre del Chofer:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="driver_name"
                                            id="id_driver_name" placeholder="Chofer de la gandola">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Guía:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="ficha" id="id_ficha"
                                            placeholder="orden que tiene el transportista">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Sindicato:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="syndicate" id="id_syndicate" placeholder="Nombre del sindicato">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Puerto:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="port" id="id_port" value="{{ orden.port_name }}" readonly>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> T.Muelle:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="T_Muelle" id="id_T_Muelle" value="{{ orden.numero_muelle }}" readonly> 
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Barco/ALM:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="boat_alm"
                                            id="id_boat_alm" placeholder="Barco que va a Cargar/Descargar" value="{{ orden.buque_name }}" readonly>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Dirección:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" id="exampleTextarea1" rows="4" name="direction"
                                        ></textarea>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Flete pagado por:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="freight_paid_by"
                                            id="id_freight_paid_by">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Comentario:</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <textarea class="form-control" id="exampleTextarea2" rows="4" name="comment"></textarea>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Peso bruto  (TM) :</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="gross_weight" id="id_gross_weight" placeholder="Peso del camión vacío">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> Peso de tara  (TM) :</li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="tare_weight" id="id_tare_weight" placeholder="Peso del camión con la carga">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label class="col-sm-4 col-form-label">
                                        <li> <strong> Peso neto  (TM) :</strong></li>
                                    </label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control add-order" name="trans_net_weight" id="id_trans_net_weight" placeholder="Peso neto" disabled>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-sm-12">
                                        <button class="btn btn-sm btn-success mt-xl-1" type="button"
                                            style="float: right;" id="transport_add">Añadir
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                
                <!-- <div class="text-right pt-xl-2 mb-xl-2">
                    <a href="{% url 'transactions:finish_trans' pk=orden.pk %}" class="btn btn-danger mr-xl-2" id="finish">Finalizar orden</a><button type="submit" class="btn btn-success">Actualizar orden</button>
                </div> -->
                    </div>
                    <div class="col-md-5">
                        <div class="col-md-12 rounded border border-info d-inline-block leyend" style="overflow-y: auto; overflow-x: hidden; max-height: 3540px;">
                            <div class="text-center mt-xl-3">
                                <h3 style="font-weight: bold;">Resultado de la operación:</h3>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <label class="col-sm-12 col-form-label text-center fs-20 mt-xl-3" style="font-weight: bold;">Estatus de operación:</label>
                                    <div class="col-sm-12 ml-xl-3">
                                        {{ form.status }}
                                        <ul id="status_list">
                                            {% if orden.status.all %}
                                            {% for state in orden.status.all %}
                                            <li>
                                                <span>Estado: {{ state.state }} <br>
                                                    Comentario: {{ state.comment }} <br>
                                                    Fecha: {{ state.fecha|date:"d/m/Y g:i:a" }}
                                                </span>
                                            </li>
                                            {% endfor %}
                                            {% else %}
                                            <li id="not_status">
                                                No hay Estatus registrados
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                    <div class="col-md-12 mt-xl-3" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                    <label class="col-sm-12 col-form-label text-center fs-20 mt-xl-3" style="font-weight: bold;">Draft surveys:  (TM) </label>
                                    <div class="col-sm-12 ml-xl-3">
                                        <ul id="" style="margin-bottom: 0px;">
                                            <li>
                                                <span style="font-size: 18px;"><strong> Cantidad nominada: <span id="load_port">{% if orden.order_type == 'descarga' %} {{ orden.total_product_weight|floatformat:3|intcomma }} {% else %} {{ orden.cant_carg|floatformat:3|intcomma }} {% endif %}</span>   (TM) </strong></span>
                                            </li>
                                                <li>
                                                    <span style="font-size: 20px;" id="draft-span1"><strong> Draft Inicial {% if orden.order_type == 'descarga' %}  +  {% endif %} (Constante): <span id="draft-span">{% if orden.draft > 0 %} {{ orden.draft|floatformat:3|intcomma }} {% endif %}</span>   (TM) </strong></span><span id="button-draft_span"></span>
                                                </li>
                                            <li>
                                                <span style="font-size: 20px;" id="span-draft-final"><strong> Draft Final: <span id="final-draft-span">{% if orden.final_draft %} {{ orden.final_draft|floatformat:3|intcomma }} {% endif %}</span>   (TM) </strong></span>
                                            </li>
                                            {% if orden.draft > orden.total_product_weight %}
                                                <li>
                                                    <span style="font-size: 10pxx; color:red">
                                                        <strong>
                                                            El draft inicial es superior a la cantidad total de la nominación.
                                                        </strong>
                                                </span>
                                            </li>
                                            {% endif %}
                                                <li>
                                                    <span style="font-size: 15px;" id="span-draft-final">
                                                        <strong> 
                                                            
                                            {% if orden.order_type == 'descarga' %}Total descargado: 
                                            
                                            <span id="total-unloaded"></span>   (TM) 
                                                        </strong>
                                                    </span>

                                            {% else %}
                                                <span id="span-load-draft1" style="font-size: 20px"> Cantidad cargada: <span id="span-load-draft"></span> TM</span>   
                                            {% endif %}
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-12 mt-xl-3" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                    <label class="col-sm-12 col-form-label text-center fs-20 mt-xl-3" style="font-weight: bold;">Bill of Lading (BL):</label>
                                    <div class="col-sm-12 ml-xl-3">
                                        {{ form.multiple_bl }}
                                        <ul id="bl_list" style="margin-bottom: 0px;">
                                            <!-- <li>
                                                <span>BL: {% if orden.bl > 0 %} {{ orden.bl|floatformat:3|intcomma }}TM {% endif %} </span>
                                            </li> -->
                                            {% if orden.multiple_bl.all %}
                                            <br>
                                            {% for bl in orden.multiple_bl.all %}
                                            <li>
                                                <span>BL: {{ bl.bl|floatformat:3|intcomma }}  (TM) . ({{ bl.product.name|upper }}) {{ bl.receiving_customer.company_name }}<br>
                                                </span>
                                            </li>
                                            {% endfor %}
                                            {% endif %}
                                        </ul>
                                        <ul>
                                            <li>
                                                {{ form.total_bls }}
                                                <span style="font-weight: bold;">Total BL: <span id="total_bl"> {% if orden.total_bls > 0 %} {{ orden.total_bls|floatformat:3|intcomma }}  (TM) {% endif %}</span>  <br>
                                                </span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-12 mt-xl-3" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                    <label class="col-sm-12 col-form-label mt-xl-3 text-center fs-20"
                                        style="padding-top: 0px;font-weight: bold;" >Bodegas:  (TM) </label>
                                    <div class="col-sm-12 ml-xl-3">
                                        {{ form.Wineries }}
                                        <ul id="wineries_list" style="margin-bottom: 0px;">
                                            {% if orden.Wineries.all %}
                                                {% for winerie in orden.Wineries.all %}
                                                <li>
                                                    <span>
                                                        {{ winerie.product.name|upper }}. <strong>(Bdga/ALM :{{ winerie.number|title }})</strong> <br>
                                                        {{ winerie.weight|floatformat:3|intcomma }}  (TM)  <br> Fecha de adición:
                                                        {{ winerie.start_date|date:"d/m/Y g:i:a" }}
                                                    </span>

                                                </li>
                                                <div class="col-md-12 mt-xl-3" style="margin-top: 0px; margin-left: -8%;"> <hr> </div> 
                                                {% endfor %}
                                            {% else %}
                                                <li id="not_winerie">
                                                    No hay bodegas registradas
                                                </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                    
                                    <div class="col-sm-12 ml-xl-3">
                                        <br>
                                        <b style="font-size: 18px;">Total en bodegas: <span id="net_weight">{{ orden.net_weight|floatformat:3|intcomma }}</span>  (TM) </b>
                                        <input type="text" step="0.01" name="net_weight" id="id_net_weight" value="{% if orden.net_weight %}{{ orden.net_weight|floatformat:3}}{% else %} 0 {% endif %}" class="d-none">
                                    </div>

                                    <div class="col-md-12 mt-xl-3" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                    <label class="col-sm-12 col-form-label mt-xl-3 text-center fs-20"
                                        style="padding-top: 0px; font-weight: bold;">
                                        Lista de Destinos:
                                    </label>
                                    <div class="col-sm-12">
                                        {{ form.destinations }}
                                        <ul id="destinations_list" class="col-md-12" style="margin-bottom: 0px;">
                                            {% if orden.destinations.all %}
                                            {% for destiny in orden.destinations.all %}
                                            <li class="col-md-12">
                                                <span>Recibidor: {{ destiny.customer_name.company_name|title }} <br> Destino: {{ destiny.destiny }} {% for product in destiny.product.all %} <br> Producto: {{ product.name|upper }} {% endfor %} <br> Fecha de adición: {{ destiny.start_date|date:"d/m/Y g:i:a" }}</span>
                                            </li>
                                            <div class="col-md-12 mt-xl-3" style="margin-top: 0px;">
                                                <hr>
                                            </div>
                                            {% endfor %}
                                            {% else %}
                                            <li id="not_destiny">
                                                No hay destinos registrados
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                    <div class="col-md-12" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                    <label class="col-sm-12 col-form-label mt-xl-3 text-center fs-20"
                                        style="padding-top: 0px; font-weight: bold;">
                                        Transporte:
                                    </label>
                                    <div class="col-sm-12">
                                        <ul id="transport_list" class="col-md-12" style="margin-bottom: 0px;">
                                            {% if orden.transport.all %}
                                            {% for trans in orden.transport.all %}
                                            <li class="col-md-12">
                                                <span>
                                                    Cliente Recibidor: {{ trans.customer_name.name|title }} 
                                                    <br> 
                                                    °Empresa: {{ trans.customer_name.company_name|title }}
                                                    <br>
                                                    °Bodega: {{ trans.bodega|title }}
                                                    <br>
                                                    ° Viaje: {{ trans.viaje }}
                                                    <br>
                                                    ° Fecha de adición: {{ trans.start_date|date:"d/m/Y g:i:a" }}</span>
                                                    <br>
                                                    ° Tipo de vehículo: {{ trans.vehicle|title }}
                                                    <br>
                                                    ° Placa: {{ trans.license_plate|title }}
                                                    <br>
                                                    ° Nombre del chofer: {{ trans.driver_name|title }}
                                                    <br>
                                                    ° Guía: {{ trans.ficha|title }}
                                                    <br>
                                                    ° Barco/ALM: {{ trans.boat_alm|title }}
                                                    <br>
                                                    ° Dirección: {{ trans.direction|title }}
                                                    <br>
                                                    ° Flete pagado por: {{ trans.freight_paid_by|title }}
                                                    <br>
                                                    ° Comentario: {{ trans.comment|title }}
                                                    <br>
                                                    ° Sindicato: {{ trans.syndicate|title }}
                                                    <br>
                                                    ° Placa del deposito: {{ trans.tank_plate|title }}
                                                    <br>
                                                    ° Peso de tara: {{ trans.tare_weight|title|floatformat:3|intcomma }}  (TM) 
                                                    <br>
                                                    ° Peso bruto: {{ trans.gross_weight|title|floatformat:3|intcomma }}  (TM) 
                                                    <br>
                                                    ° <strong> Peso Neto: {{ trans.net_weight|title|floatformat:3|intcomma }}  (TM) </strong>
                                                    <br>
                                                    ° Puerto: {{ trans.port|title }}
                                                    <br>
                                                    ° T.Muelle: {{ trans.T_Muelle|title }}
                                            </li>
                                            <div class="col-md-12 mt-xl-3" style="margin-top: 0px;">
                                                <hr>
                                            </div>
                                            {% endfor %}
                                            {% else %}
                                            <li id="not_transport" class="mb-xl-3">
                                                No hay transportes registrados
                                            </li>
                                            {% endif %}
                                        </ul>
                                    </div>
    
                                    <div class="col-sm-12">
                                        <li style="font-weight: bold;">Total de la Pesada: <span id="pesada">{{ orden.transport_heavy|floatformat:3|intcomma }}  (TM) </span></li>
                                    </div>
                                    <div class="col-md-12" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                    <div class="col-sm-12">
                                        <li style="font-weight: bold;">
                                              {% if orden.order_type == 'carga' %}Volumen cargado:{% else %} Remanente a bordo: {% endif %} <span id="remanante"></span>  (TM) 
                                        </li>
                                    </div>
                                    <div class="col-md-12" style="margin-top: 0px;">
                                        <hr>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-right pt-xl-2 mb-xl-2">
                            <button type="button" class="btn btn-danger" data-toggle="modal"
                                    data-target="#exampleModal" id="">
                                    Finalizar orden
                                </button>&nbsp;&nbsp;<button type="submit" class="btn btn-success">Guardar cambios</button>
                        </div>
                    </div>
                </div>
                {% if redirect_field_value %}
                <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
                {% endif %}
                <input type="hidden" name="user" id="id_user" value="{{ orden.user.id }}">
                <input type="hidden" name="order_type" id="id_order_type" value="{{ orden.order_type }}">
                <input type="hidden" name="order_number" id="id_order_number" value="{{ orden.order_number }}">
                <input type="hidden" name="number_invoice_client" id="number_invoice_client" value="{{ orden.number_invoice_client }}">
                <input type="hidden" name="number_invoice_aivepet" id="number_invoice_aivepet" value="{{ orden.number_invoice_aivepet }}">
                <input type="hidden" name="unit_measurement" id="id_unit_measurement"
                    value="{{ orden.unit_measurement }}">
                <input type="hidden" name="comment_initial" id="id_comment_initial" value="{{ orden.comment_initial }}">
                <input type="hidden" name="updates" id="id_updates" value="{{ orden.updates }}">
                <input type="number" name="total_weighing" id="id_total_weighing" value="{% if orden.total_weighing %}{{ orden.total_weighing|floatformat:3 }}{% else %} 0 {% endif %}" class="d-none">
                <!-- <input type="hidden" name="customer_name" id="id_customer_name" value="{{ orden.customer_name }}"> -->
                {{ form.product }}
                {{ form.transport }}
                {{ form.customer_name }}
                <input type="hidden" name="company_name" id="id_company_name" value="{{orden.company_name}}">
                <input type="hidden" name="name" id="id_name" value="{{orden.name}}">
                <input type="hidden" name="tipdoc" id="id_tipdoc" value="{{orden.tipdoc}}">
                <input type="hidden" name="dni" id="id_dni" value="{{orden.dni}}">
                <input type="hidden" name="buque_name" id="id_buque_name" value="{{ orden.buque_name }}">
                <input type="hidden" name="port_name" id="id_port_name" value="{{ orden.port_name }}">
                <input type="hidden" name="numero_muelle" id="id_numero_muelle" value="{{ orden.numero_muelle }}">
                <input type="hidden" name="transport_heavy" id="id_transport_heavy" value="{% if orden.transport_heavy %}{{ orden.transport_heavy }}{% else %}0{% endif %}">
                <input type="hidden" name="start_date" id="id_start_date" value="{{ orden.start_date }}">
                <input type="hidden" name="nominal_id" id="id_nominal_id" value="{{ orden.nominal_id }}">
            </form>
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header text-center">
                <h5 class="modal-title w-100" id="exampleModalLabel">FINALIZACIÓN DE ORDEN</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <h4 class="text-center">¿Está usted seguro?</h4>
                Está acción no es reversible, luego de finalizar la transacción esta misma no podrá ser editada.
                <br><br>
                <span style="font-size: 18px; display: flex;justify-content: center" class="text-center mx-auto" ><strong>Asegurese de haber guardado los cambios previamente, Esta acción no registrará cambios sin guardar</strong></span>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary ml-auto" data-dismiss="modal" style="color: white;">Cerrar</button>
                <a href="{% url 'transactions:finish_trans' pk=orden.pk %}" class="btn btn-danger mr-xl-2" id="finish">Confirmar</a>
            </div>
        </div>
    </div>
</div>


        </div>
    </div>
</div>


{% endblock %}

{% block extra_js %}
<script>

    var update = parseInt($('#id_updates').val());
    let orderType = '{{ orden.order_type }}'
    update = update + 1
    $('#id_updates').val(update)

    $('#id_Wineries').css('display', 'none')
    $('#id_product').css('display', 'none')
    $('#id_destinations').css('display', 'none')
    $('#id_receiving_customer').css('display', 'none')
    $('#id_customer_name').css('display', 'none')
    $('#id_transport').css('display', 'none')
    $('#id_weight_record').css('display', 'none')
    $('#id_status').css('display', 'none')
    $('#id_multiple_bl').css('display', 'none')
    $('#id_total_bls').css('display', 'none')
    
    // $("#status_date").val(new Date().toJSON().slice(0,19));

    function calculate(){
        if($('#id_gross_weight').val() && $('#id_tare_weight').val()){
            pesoTara = parseFloat($('#id_tare_weight').val().replace('.','').replace(',','.'))
            pesoBruto = parseFloat($('#id_gross_weight').val().replace('.','').replace(',','.'))
            console.log($('#id_tare_weight').val().replace('.','').replace(',','.'))
            console.log($('#id_gross_weight').val().replace('.','').replace(',','.'))
            console.log(pesoTara)
            console.log(pesoBruto)
            pesoNeto = Math.abs(pesoTara - pesoBruto).toFixed(3)
            pesoNeto1 = pesoNeto.toString();
            pesoNeto1 = pesoNeto1.replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
            $('#id_trans_net_weight').val(pesoNeto1)
        }
    }

    
    let newqanC = 0
    function calculateNewQan(){
        newqanC = 0
        if(
            $('#id_draft1').val() != '' && 
            $('#final_draft1').val() != '' && 
            $('#final_draft1').val()!='0,000' && 
            $('#id_draft1').val() != '0,000' && 
            $('#final_draft1').val()!='0.000' && 
            $('#id_draft1').val() != '0.000'){
            let draft_inicialC = parseFloat($('#id_draft').val())
            let draft_finalC = parseFloat($('#final_draft').val())
            if(orderType == 'carga'){
                newqanC = (parseFloat(draft_finalC) - parseFloat(draft_inicialC)).toFixed(3)
            }else{
                newqanC = (parseFloat(draft_inicialC - parseFloat(draft_finalC))).toFixed(3)
            }
            let newc = newqanC.replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
            $('#id_new_qan1').val(newc)
            $('#id_new_qan').val(newc)
            $('#span-load-draft').text(newc)
        }
    }
    calculateNewQan()

    $('#id_draft1').on('change', function(){
        calculateNewQan()
    })
    $('#final_draft1').on('change', function(){
        calculateNewQan()
    })

    $('#id_gross_weight').on('change', function(){
        calculate()
    })
    $('#id_tare_weight').on('change', function(){
        calculate()
    })

    $('#bodega_nueva').keypress(function (e) {
        if (e.keyCode == 13) {
            event.preventDefault()
            if(!$('#bodega_nueva').val() || !$('#bodega_peso').val()){
            if(!$('#bodega_nueva').val()){
                    $('#bodega_nueva').css('border-color', 'red')
                }
            if(!$('#bodega_peso').val()){
                    $('#bodega_peso').css('border-color', 'red')
                }
            }else{
                
                let bodega_peso = $("#bodega_peso").val();
                bodega_peso = bodega_peso.replace('.', '').replace(',','.')
                bodega_peso = parseFloat(bodega_peso)
                $.ajax({
                    data: {
                        'transaccion': $('#id_order_number').val(),
                        'bodega_nueva': $("#bodega_nueva").val(),
                        'producto': $('#bodega_product').val(),
                        'peso': bodega_peso,
                    },
                    url: "{% url 'transactions:add_wineries' %}",
                    type: 'post',
                    beforeSend: function () { },
                    success: function (data) {
                        $('#bodega_nueva').val('')
                        $('#bodega_peso').val('')
                        var val = data[0].pk
                        var name = data[0].fields.number
                        var product = data[1].fields.name
                        var weight = data[0].fields.weight
                        let weight1 = parseFloat(weight)
                        weight1 = weight1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
                        $('#id_Wineries').append('<option selected value=' + val + '>' + name + ': ' + product + '; Peso: ' + weight + ' TM</option>');
                        $('#id_bodega_transport').append('<option selected value=' + name + '>' + product + '.  <strong>Bdga/ALM :</strong> ' + name + '</option>');
                        $("#wineries_list").append('<li><span style="color: #51A351">' + product + '.  <strong>Bdga/ALM :</strong> ' + name + '; ' + weight1 + '  (TM) </span></li>');
                        $('#not_winerie').css('display', 'none');
                        var weight_act = $('#id_net_weight').val();
                        weight_act = parseFloat(weight_act)
                        $('#id_net_weight').val(weight_act + parseFloat(weight));
                        $('#net_weight').text($('#id_net_weight').val())
                        $('#id_net_weight').val($('#id_net_weight').val())
                        
                        $('#id_net_weight').val(parseFloat($('#id_net_weight').val()))
                    },
                });
            }
        }
    })
    $('#bodega_peso').keypress(function (e) {
        if (e.keyCode == 13) {
            event.preventDefault()
            if(!$('#bodega_nueva').val() || !$('#bodega_peso').val()){
            if(!$('#bodega_nueva').val()){
                    $('#bodega_nueva').css('border-color', 'red')
                }
            if(!$('#bodega_peso').val()){
                    $('#bodega_peso').css('border-color', 'red')
                }
            }else{
                
                let bodega_peso = $("#bodega_peso").val();
                bodega_peso = bodega_peso.replace('.', '').replace(',','.')
                bodega_peso = parseFloat(bodega_peso)
                $.ajax({
                    data: {
                        'transaccion': $('#id_order_number').val(),
                        'bodega_nueva': $("#bodega_nueva").val(),
                        'producto': $('#bodega_product').val(),
                        'peso': bodega_peso,
                    },
                    url: "{% url 'transactions:add_wineries' %}",
                    type: 'post',
                    beforeSend: function () { },
                    success: function (data) {
                        $('#bodega_nueva').val('')
                        $('#bodega_peso').val('')
                        var val = data[0].pk
                        var name = data[0].fields.number
                        var product = data[1].fields.name
                        var weight = data[0].fields.weight
                        
                        
                        let weight1 = parseFloat(weight)
                        weight1 = weight1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
                        $('#id_Wineries').append('<option selected value=' + val + '>' + name + ': ' + product + '; Peso: ' + weight + ' Toneladas</option>');
                        $('#id_bodega_transport').append('<option selected value=' + name + '>' + product + '.  <strong>Bdga/ALM :</strong> ' + name + '</option>');
                        $("#wineries_list").append('<li><span style="color: #51A351">' + product + '.  <strong>Bdga/ALM :</strong> ' +  name + '; ' + weight1 + '  (TM) </span></li>');
                        $('#not_winerie').css('display', 'none');

                        var weight_act = Number($('#id_net_weight').val());
                        $('#id_net_weight').val(weight_act + Number(weight));

                        $('#net_weight').text($('#id_net_weight').val())
                    },
                });
            }
        }
    })

    $('#bodega_nueva').on('click', function(){
        $(this).css('border-color', '')
    })
    $('#bodega_peso').on('click', function(){
        $(this).css('border-color', '')
    })

    $('#bodega_nueva_button').on('click', function () {
        event.preventDefault();
        if(!$('#bodega_nueva').val() || !$('#bodega_peso').val()){
            if(!$('#bodega_nueva').val()){
                    $('#bodega_nueva').css('border-color', 'red')
                }
            if(!$('#bodega_peso').val()){
                    $('#bodega_peso').css('border-color', 'red')
                }
            }else{
                
                let bodega_peso = $("#bodega_peso").val();
                bodega_peso = bodega_peso.replace('.', '').replace(',','.')
                bodega_peso = parseFloat(bodega_peso)
                $.ajax({
                    data: {
                        'transaccion': $('#id_order_number').val(),
                        'bodega_nueva': $("#bodega_nueva").val(),
                        'producto': $('#bodega_product').val(),
                        'peso': bodega_peso,
                    },
                    url: "{% url 'transactions:add_wineries' %}",
                    type: 'post',
                    beforeSend: function () { },
                    success: function (data) {
                        console.log(data)
                        $('#bodega_nueva').val('')
                        $('#bodega_peso').val('')
                        var val = data[0].pk
                        var name = data[0].fields.number
                        var product = data[1].fields.name
                        var weight = data[0].fields.weight
                        
                        
                        let weight1 = parseFloat(weight)
                        weight1 = weight1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");

                        var weight_act = $('#id_net_weight').val();
                        weight_act = parseFloat(weight_act)
                        
                        $('#id_Wineries').append('<option selected value=' + val + '>' + name + ': ' + product.toUpperCase()  + '; Peso: ' + weight + ' Toneladas</option>');
                        
                        $('#id_bodega_transport').append('<option value=' + val + '>' + product.toUpperCase()  + '.  <strong>Bdga/ALM :</strong> ' + name + '</option>');
                        $("#wineries_list").append('<li id="winerie-'+ val +'"><span style="color: #51A351"><button type="button" class="close" data-dismiss="alert" id="button-'+ val +'" onclick="deleteWinerie(this.id,'+ weight_act +','+ weight+')" ><span aria-hidden="true">&times;</span></button>' + product.toUpperCase()  + '.  <strong>Bdga/ALM :</strong> ' + name + '; ' + weight1 + '  (TM) </span></li> <div class="col-md-12 mt-xl-3" style="margin-top: 0px; margin-left: -8%;"> <hr> </div>  ');
                        $('#not_winerie').css('display', 'none');
                        let net = (weight_act + parseFloat(weight)).toFixed(3)
                        console.log(net)
                        $('#id_net_weight').val(weight_act + parseFloat(weight));
                        $('#net_weight').text(net.replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, "."))
                        $('#id_net_weight').val($('#id_net_weight').val())
                        
                        $('#id_net_weight').val(parseFloat($('#id_net_weight').val()))
                    },
                });
            }
    })

    $('#destino_button').on('click', function () {
        event.preventDefault();
        if(!$('#destino_input').val() || ! $('#destiny_product').val() || !$('#destiny_customer').val()){
            if(!$('#destino_input').val()){
                    $('#destino_input').css('border-color', 'red')
                }
            if(!$('#destiny_product').val()){
                    $('#destiny_product').css('border-color', 'red')
            }
            if(!$('#destiny_customer').val()){
                    $('#destiny_customer').css('border-color', 'red')
            }
        }else{
            $.ajax({
                data: {
                    'destino' :$('#destino_input').val(),
                    'product' :$('#destiny_product').val(),
                    'customer':$('#destiny_customer').val(),
                },
                url: "{% url 'transactions:add_destinations' %}",
                type: 'post',
                beforeSend: function () { },
                success: function (data) {
                    console.log(data)
                    $('#destino_input').val('')
                    var val = data[0].pk
                    var destiny = data[0].fields.destiny
                    var customer_company = data[1].fields.company_name
                    var customer_name = data[1].fields.company_name
                    var product = data[2].fields.name
                    $('#id_destinations').append('<option selected value=' + val + '>' + destiny + ' Toneladas</option>');
                    $("#destinations_list").append('<li style="color: #51A351" class="col-md-12" id="destiny-'+ val +'"><button type="button" class="close" data-dismiss="alert" id="button-'+ val +'" onclick="deleteDestiny(this.id,)" ><span aria-hidden="true">&times;</span></button>Proveedor: '+ customer_company +'<br>Dirección: ' + destiny + '<br> Producto: '+ product+'</li><div class="col-md-12 mt-xl-3" style="margin-top: 0px;"> <hr> </div> ');
                    $('#not_destiny').css('display', 'none');
                },
            });
        }
    })

    $('#destino_input').keypress(function (e) {
        if (e.keyCode == 13) {
            event.preventDefault()
            if(!$('#destino_input').val() || ! $('#destiny_product').val() || !$('#destiny_customer').val()){
            if(!$('#destino_input').val()){
                    $('#destino_input').css('border-color', 'red')
                }
            if(!$('#destiny_product').val()){
                    $('#destiny_product').css('border-color', 'red')
            }
            if(!$('#destiny_customer').val()){
                    $('#destiny_customer').css('border-color', 'red')
            }
        }else{
            $.ajax({
                data: {
                    'destino' :$('#destino_input').val(),
                    'product' :$('#destiny_product').val(),
                    'customer':$('#destiny_customer').val(),
                },
                url: "{% url 'transactions:add_destinations' %}",
                type: 'post',
                beforeSend: function () { },
                success: function (data) {
                    $('#destino_input').val('')
                    var val = data[0].pk
                    var destiny = data[0].fields.destiny
                    var customer = data[1].fields.customer_name
                    var product = data[2].fields.product
                    $('#id_destinations').append('<option selected value=' + val + '>' + destiny + ' Toneladas</option>');
                    $("#destinations_list").append('<li class="col-md-12" style="color: #51A351">Proveedor: '+ customer +'<br>Dirección: ' + destiny + '<br> Producto: '+ product+'</li>');
                    $('#not_destiny').css('display', 'none');
                },
            });
        }
        }
    })

    $('#cliente_recibidor_comprador').on('click', function(){
        $(this).css('border-color', '')
    })
    $('#cliente_recibidor_empresa').on('click', function(){
        $(this).css('border-color', '')
    })
    $('#cliente_recibidor_dni').on('click', function(){
        $(this).css('border-color', '')
    })
    $('#cliente_recibidor_tipdoc').on('click', function(){
        $(this).css('border-color', '')
    })

    $('#cliente_recibidor_button').on('click', function () {
        event.preventDefault();
        if(!$('#cliente_recibidor_comprador').val() || !$('#cliente_recibidor_empresa').val() || !$('#cliente_recibidor_dni').val()){
            if(!$('#cliente_recibidor_comprador').val()){
                $('#cliente_recibidor_comprador').css('border-color', 'red')
            }
            if(!$('#cliente_recibidor_empresa').val()){
                    $('#cliente_recibidor_empresa').css('border-color', 'red')
                }
            if(!$('#cliente_recibidor_dni').val()){
                    $('#cliente_recibidor_dni').css('border-color', 'red')
                }
            if(!$('#cliente_recibidor_tipdoc').val()){
                    $('#cliente_recibidor_tipdoc').css('border-color', 'red')
                }
        }else{
            $.ajax({
                data: {
                    'cliente': $('#cliente_recibidor_comprador').val(),
                    'empresa': $('#cliente_recibidor_empresa').val(),
                    'dni': $('#cliente_recibidor_dni').val(),
                    'tipodc': $('#cliente_recibidor_tipdoc option:selected').val()
                },
                url: "{% url 'transactions:add_reciving_customers' %}",
                type: 'post',
                beforeSend: function () { },
                success: function (data) {
                    $('#cliente_recibidor_comprador').val('')
                    $('#cliente_recibidor_empresa').val('')
                    $('#cliente_recibidor_dni').val('')
                    var val = data[0].pk
                    var name = data[0].fields.name
                    var company = data[0].fields.company_name
                    var dni = data[0].fields.dni
                    var tipdoc = data[0].fields.tipdoc
                    $('#id_receiving_customer').append('<option selected value=' + val + '>' + name + ' </option>');
                    $('#destiny_customer').append('<option value=' + val + '>' + name + ' </option>');
                    $("#customer_list").append('<li style="color: #51A351"> Empresa: '+ company + '<br> Responsable: ' + name + '<br> '+ tipdoc +': ' + dni + '</li>');
                    $('#not_customer').css('display', 'none');
                },
            });
        }
    })

    $('#cliente_recibidor_dni').keypress(function (e) {
        if (e.keyCode == 13) {
            event.preventDefault()
            if(!$('#cliente_recibidor_comprador').val() || !$('#cliente_recibidor_empresa').val() || !$('#cliente_recibidor_dni').val()){
            if(!$('#cliente_recibidor_comprador').val()){
                $('#cliente_recibidor_comprador').css('border-color', 'red')
            }
            if(!$('#cliente_recibidor_empresa').val()){
                    $('#cliente_recibidor_empresa').css('border-color', 'red')
                }
            if(!$('#cliente_recibidor_dni').val()){
                    $('#cliente_recibidor_dni').css('border-color', 'red')
                }
            if(!$('#cliente_recibidor_tipdoc').val()){
                    $('#cliente_recibidor_tipdoc').css('border-color', 'red')
                }
            }else{
                $.ajax({
                    data: {
                        'cliente': $('#cliente_recibidor_comprador').val(),
                        'empresa': $('#cliente_recibidor_empresa').val(),
                        'dni': $('#cliente_recibidor_dni').val(),
                        'tipodc': $('#cliente_recibidor_tipdoc option:selected').val()
                    },
                    url: "{% url 'transactions:add_reciving_customers' %}",
                    type: 'post',
                    beforeSend: function () { },
                    success: function (data) {
                        $('#cliente_recibidor_comprador').val('')
                        $('#cliente_recibidor_empresa').val('')
                        $('#cliente_recibidor_dni').val('')
                        var val = data[0].pk
                        var name = data[0].fields.name
                        var company = data[0].fields.company_name
                        var dni = data[0].fields.dni
                        var tipdoc = data[0].fields.tipdoc
                        $('#id_receiving_customer').append('<option selected value=' + val + '>' + name + ' </option>');
                        $('#destiny_customer').append('<option value=' + val + '>' + name + ' </option>');
                        $("#customer_list").append('<li style="color: #51A351"> Empresa: '+ company + '<br> Responsable: ' + name + '<br> '+ tipdoc +': ' + dni + '</li>');
                        $('#not_customer').css('display', 'none');
                    },
                });
            }
        }
    })
    $('#transport_add').on('click', function () {
        event.preventDefault();
        let id_gross_weight = parseFloat($('#id_gross_weight').val().replace('.','').replace(',','.')).toFixed(3)
        let id_tare_weight = parseFloat($('#id_tare_weight').val().replace('.','').replace(',','.')).toFixed(3)
        let id_trans_net_weight = parseFloat($('#id_trans_net_weight').val().replace('.','').replace(',','.')).toFixed(3)
        $.ajax({
            data: {
                'transaction_id' : $('#transaction_id').val(),
                'id_vehicle': $('#id_vehicle').val(),
                'id_license_plate': $('#id_license_plate').val(),
                'id_tank_plate': $('#id_tank_plate').val(),
                'id_driver_name': $('#id_driver_name').val(),
                'id_ficha': $('#id_ficha').val(),
                'id_boat_alm': $('#id_boat_alm').val(),
                'id_balance': $('#id_balance').val(),
                'id_freight_paid_by': $('#id_freight_paid_by').val(),
                'id_direction': $('#exampleTextarea1').val(),
                'id_comment': $('#exampleTextarea2').val(),
                'id_syndicate': $('#id_syndicate').val(),
                'id_port': $('#id_port').val(),
                'id_T_Muelle': $('#id_T_Muelle').val(),
                'id_gross_weight': id_gross_weight,
                'id_tare_weight': id_tare_weight,
                'id_net_weight': id_trans_net_weight,
                'id_transport_customer': $('#id_transport_customer option:selected').val(),
                'id_bodega_transport': $('#id_bodega_transport option:selected').val()
            },
            url: "{% url 'transactions:add_transport' %}",
            type: 'post',
            beforeSend: function () { },
            success: function (data) {
                $('#id_license_plate').val('')
                $('#id_tank_plate').val('')
                $('#id_driver_name').val('')
                $('#id_ficha').val('')
                $('#id_balance').val('')
                $('#id_freight_paid_by').val('')
                $('#exampleTextarea1').val('')
                $('#exampleTextarea2').val('')
                $('#id_syndicate').val('')
                $('#id_gross_weight').val('')
                $('#id_tare_weight').val('')
                $('#id_trans_net_weight').val('')
                $('#id_transport_customer').val('')
                var val = data[0].pk
                var id_transport_customer = data[1].fields.name + ' <br> Empresa: ' +  data[1].fields.company_name
                var viaje = data[0].fields.viaje
                var id_vehicle = data[0].fields.vehicle
                var start_date = data[0].fields.start_date
                var license_plate = data[0].fields.license_plate
                var tank_plate = data[0].fields.tank_plate
                var driver_name = data[0].fields.driver_name
                var ficha = data[0].fields.ficha
                var syndicate = data[0].fields.syndicate
                var port = data[0].fields.port
                var T_Muelle = data[0].fields.T_Muelle
                var direction = data[0].fields.direction
                var boat_alm = data[0].fields.boat_alm
                var balance = data[0].fields.balance
                var freight_paid_by = data[0].fields.freight_paid_by
                var comment = data[0].fields.comment
                var gross_weight = data[0].fields.gross_weight
                var tare_weight = data[0].fields.tare_weight
                var net_weight = data[0].fields.net_weight
                var bodega = data[0].fields.bodega
                var pesoActual = parseFloat($('#id_transport_heavy').val())
                var pesadaActual = (pesoActual + parseFloat(net_weight)).toFixed(3)

                let gross_weight1 = parseFloat(gross_weight)
                gross_weight1 = gross_weight1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
                
                let tare_weight1 = parseFloat(tare_weight)
                tare_weight1 = tare_weight1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");

                
                let net_weight1 = parseFloat(net_weight)
                net_weight1 = net_weight1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
                console.log('ok')
                console.log(data)
                
                $('#pesada').text((pesadaActual.toString().replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".")) + ' (TM) ')
                $('#id_transport_heavy').val(pesadaActual)
                $('#id_transport').append('<option selected value=' + val + '> </option>');
                $("#transport_list").append('<li style="color: #51A351" id="transport-'+ val +'"> <button type="button" class="close" data-dismiss="alert" id="button-'+ val +'" onclick="deleteTransport(this.id,'+ net_weight +')" ><span aria-hidden="true">&times;</span></button> Cliente Recibidor: ' + id_transport_customer + ' <br>Bodega: '+ bodega +'<br>° Viaje: ' + viaje + '<br>° Fecha de adición: ' + start_date + '<br>° Tipo de vehículo: ' + id_vehicle + '<br>° Placa: ' + license_plate + '<br>° Placa del Depósito: ' + tank_plate + '<br>° Nombre del chofer: ' + driver_name + '<br>° Ficha: ' + ficha + '<br>° Sindicato: '+ syndicate +'<br>° Puerto: '+ port + '<br>°  T.Muelle:'+ T_Muelle +'<br>° Barco/ALM: '+ boat_alm  + '<br>° Dirección: ' + direction + '<br>° Flete pagador por: ' + freight_paid_by + '<br>° Comentario: ' + comment + '<br>° Peso bruto: '+ gross_weight1 + ' (TM)  <br>° Peso de tara: '+ tare_weight1 + ' (TM)  <br>° Peso neto: '+ net_weight1+' (TM)  </li> <div class="col-md-12 mt-xl-3" style="margin-top: 0px;"> <hr> </div> ');
                $('#not_transport').css('display', 'none');
                remanante()
            },
        });
    })


    $('#status_Add').on('click', function () {
        event.preventDefault();
        $.ajax({
            data: {
                'status' : $('#status_new').val(),
            },
            url: "{% url 'transactions:status_add' %}",
            type: 'post',
            beforeSend: function () { },
            success: function (data) {
                $('#status_new').val('')
                console.log(data)
                var val = data[0].fields.status
                
                $("#status_select").append('<option value=' + val + '> '+ val+ '</option>');
            },
        });
    })


    let timeout

    // $('#id_tare_weight').on('keydown', function(){
    //     clearTimeout(timeout)
    //         timeout = setTimeout(() => {
    //         var pesoTara = parseInt($('#id_tare_weight').val())
    //         var pesada = parseInt($('#id_heavy').val())
    //         if(pesoTara && pesada){
    //            $('#id_total_weighing').val(pesoTara+pesada)
    //         }
    //         // $('#id_total_weighing').val($(this).val() +$('#id_heavy').val())
    //         clearTimeout(timeout)
    //         },1000)
    // })

    // $('#id_heavy').on('keydown', function(){
    //     clearTimeout(timeout)
    //         timeout = setTimeout(() => {
    //         var pesoTara = parseInt($('#id_tare_weight').val())
    //         var pesada = parseInt($('#id_heavy').val())
    //         if(pesoTara && pesada){
    //            $('#id_total_weighing').val(pesoTara+pesada)
    //         }
    //         clearTimeout(timeout)
    //         },1000)
    // })

    $('#status_date').on('click', function(){
        $(this).css('border-color', '')
    })
    $('#status_comment').on('click', function(){
        $(this).css('border-color', '')
    })
    $('#status_button').on('click', function(){
        event.preventDefault();
        if(!$('#status_select').val() || !$('#status_date').val() || !$('#status_comment').val()){
            if(!$('#status_select').val()){$('#status_select').css('border-color', 'red')}
            if(!$('#status_date').val()){$('#status_date').css('border-color', 'red')}
            if(!$('#status_comment').val()){$('#status_comment').css('border-color', 'red')}
        }else{
            $.ajax({
            data: {
                'status_select': $('#status_select').val(),
                'status_date': $('#status_date').val(),
                'status_comment': $('#status_comment').val(),
            },
            url: "{% url 'transactions:add_status' %}",
            type: 'post',
            beforeSend: function () { },
            success: function (data) {
                console.log($('#status_date').val())
                console.log(data)
                var val = data[0].pk;
                var date = data[0].fields.fecha;
                var state = data[0].fields.state;
                var comment = data[0].fields.comment;
                $('#id_status').append('<option selected value=' + val + '></option>');
                $("#status_list").append('<li style="color: #51A351" id=status-'+ val +' ><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true" id="button-'+ val +'" onclick="deleteState(this.id)" >&times;</span></button> Estado: '+ state+'<br>Fecha: '+date+'<br>Comentario: '+comment +'</li>');
                $('#not_status').css('display', 'none');
            },
        });
        }
    })

    $('#multiple_bl').on('click', function(){
        event.preventDefault();
        if(!$('#id_bl_multiple').val()){
            if(!$('#id_bl_multiple').val()){$('#id_bl_multiple').css('border-color', 'red')}
        }else{
            
            let weight_buque = $("#id_bl_multiple").val();
            weight_buque = weight_buque.replace('.', '').replace(',','.')
            weight_buque = parseFloat(weight_buque)
            event.preventDefault()
            $.ajax({
            data: {
                'id_bl_multiple': weight_buque,
                'id_bl_customer': $('#id_bl_customer option:selected').val(),
                'id_bl_product': $('#id_bl_product option:selected').val(),
            },
            url: "{% url 'transactions:multiple_bl' %}",
            type: 'post',
            beforeSend: function () { },
            success: function (data) {
                console.log(data)
                var val = data[0].pk;
                var bl = data[0].fields.bl;
                var product_bl = data[2].fields.name;
                product_bl = product_bl.toUpperCase()
                var bl1 = bl;
                bl1 = bl1.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
                var t = $('#id_total_bls').val();
                if(t == '' || t == ' '){
                    t = 0;
                }
                t = (parseFloat(bl) + parseFloat(t))
                console.log(t)
                
                $('#id_multiple_bl').append('<option selected value=' + val + '></option>');
                $("#bl_list").append('<li style="color: #51A351" id=bl-'+ val +'><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true" id="button-'+ val +'" onclick="deletebl(this.id,'+ t +', '+ bl +')" >&times;</span></button> BL: '+ bl1 + '  (TM) . ('+ product_bl +') ' + data[1].fields.company_name + '</li>');
                $('#total_bl').text(t.toFixed(3).replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".") + '  (TM) ')
                $('#id_total_bls').val(t)
            },
        });
        }
    })

$('#id_net_weight').val(parseFloat($('#id_net_weight').val()))
$('#id_bl1').on('keyup', function(){
    $('#id_bl1').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
    
});
})

$('#id_bl1').on('blur', function(){  
    let bl_number = $('#id_bl1').val()
        bl_number = parseFloat(bl_number.replace('.','').replace(',','.')).toFixed(3)
        console.log(bl_number)
        $('#id_bl').val(bl_number)
});


$('#final_draft1').on('keyup', function(){
    $('#final_draft1').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
    
});
})

$('#final_draft1').on('blur', function(){  
    let bl_number = $('#final_draft1').val()
        bl_number = parseFloat(bl_number.replace('.','').replace(',','.')).toFixed(3)
        console.log(bl_number)
        $('#final_draft').val(bl_number)
});


$('#id_draft1').on('keyup', function(){
    $('#id_draft1').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
});
})


$('#id_draft1').on('blur', function(){  
    let draft_number = $('#id_draft1').val()
        draft_number = parseFloat(draft_number.replace('.','').replace(',','.')).toFixed(3)
        console.log(draft_number)
        $('#id_draft').val(draft_number)
});
$('#id_bl_multiple').on('keyup', function(){
    $('#id_bl_multiple').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
});
})

$('#bodega_peso').on('keyup', function(){
    $('#bodega_peso').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
});
})


$('#id_gross_weight').on('keyup', function(){
    $('#id_gross_weight').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
});
})

$('#id_tare_weight').on('keyup', function(){
    $('#id_tare_weight').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
});
})

function remanante(){
    let type = '{{ orden.order_type }}'
    let pesada = 0
    if (type == 'carga'){
        pesada = parseFloat($('#final_draft').val())
    }else{
        pesada = parseFloat($('#id_transport_heavy').val())
    }

    let draft = parseFloat($('#id_draft').val())
    if(pesada > 0 && draft>0){
    if(draft == '' || draft == ' '){
        draft = 0
    }
    if(pesada == '' || pesada == ' '){
        pesada = 0
    }

    let remanante = 0
    remanante = (parseFloat(draft - pesada)).toFixed(3)
    $('#remanante').text(remanante.replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, "."))
    }
}

remanante()

$('#add-cant-cargada').on('click', function(){
    let cant_carg = $('#cant_carg1').val()
    $('#span-load-draft').text(cant_carg)
    $('#load_port').text(cant_carg)
    $('#span-load-draft').append('<button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="deleteDraftload()"><span aria-hidden="true">&times;</span></button>')
    $('#span-load-draft1').css('color','#51A351')
    // $('#button-draft_span').append('<button type="button" class="close" id="button-draft-delete"><span aria-hidden="true">&times;</span></button>')
})

$('#cant_carg1').on('keyup', function(){
    $('#cant_carg1').val(function(index, value) {
    return value
        .replace(/\D/g, "")
        .replace(/([0-9])([0-9]{3})$/, '$1,$2')
        .replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".");
});
})


$('#cant_carg1').on('blur', function(){  
    let draft_number_load = $('#cant_carg1').val()
        draft_number_load = parseFloat(draft_number_load.replace('.','').replace(',','.')).toFixed(3)
        console.log(draft_number_load)
        $('#cant_carg').val(draft_number_load)
});

$('#add_draft').on('click', function(){
    let draft = $('#id_draft1').val()
    $('#draft-span').text(draft)
    $('#draft-span').append('<button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="deleteDraft()"><span aria-hidden="true">&times;</span></button>')
    $('#draft-span1').css('color','#51A351')
    // $('#button-draft_span').append('<button type="button" class="close" id="button-draft-delete"><span aria-hidden="true">&times;</span></button>')
    remanante()
    totalUnloaded()
})

$('#add_final_draft').on('click', function(){
    let draft = $('#final_draft1').val()
    $('#final-draft-span').text(draft)
    $('#final-draft-span').append('<button type="button" class="close" data-dismiss="alert" aria-label="Close" onclick="deleteDraftFinal()"><span aria-hidden="true">&times;</span></button>')
    $('#span-draft-final').css('color', '#51A351')
    remanante()
    totalUnloaded()
})

function deleteDraft(){
    $('#draft-span').text('0.000')
    $('#id_draft1').val(0)
    $('#id_draft').val(0)
    $('#span-load-draft').css('color', 'black')
    $('#final_draft').val(0)
    remanante()
}


function deleteDraftload(){
    $('#span-load-draft').text('0.000')
    $('#cant_carg1').val(0)
    $('#cant_carg').val(0)
    $('#span-draft-final').css('color', 'black')
}


function deleteDraftFinal(){
    $('#final-draft-span').text('0.000')
    $('#span-draft-final').css('color', 'black')
    $('#final_draft').val(0)
    remanante()
}

function deleteState(id){
    let pk = id.replace('button-','')
    let status_list = $('#status-'+ pk)
    status_list.remove()
    $("#id_status option[value="+ pk +"]").remove()
}


function deletebl(id,total, bl){
    let pk = id.replace('button-','')
    let bl_list = $('#bl-'+ pk)
    bl_list.remove()
    let totalbl = ($('#id_total_bls').val() - bl).toFixed(3)
    $("#id_multiple_bl option[value="+ pk +"]").remove()
    $('#id_total_bls').val(totalbl)
    $('#total_bl').text(totalbl.replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".") + '  (TM) ')
}
function deleteWinerie(id,w_act, w){
    let pk = id.replace('button-','')
    let winerie = $('#winerie-'+ pk)
    $.ajax({
        data: {
            'id_bodega': pk,
        },
        url: "{% url 'transactions:delte_wineries' %}",
        type: 'post',
        beforeSend: function () {},
        success: function (data) {
        },
    });
        winerie.remove()
        let totalw = ($('#id_net_weight').val() - w).toFixed(3)
        $("#id_Wineries option[value="+ pk +"]").remove()
        $('#id_net_weight').val(totalw)
        $('#net_weight').text(totalw)
}


function deleteDestiny(id){
    let pk = id.replace('button-','')
    let destiny_list = $('#destiny-'+ pk)
    destiny_list.remove()
    $("#id_destinations option[value="+ pk +"]").remove()
}

function deleteTransport(id, w){
    let pk = id.replace('button-','')
    let transpot = $('#transport-'+ pk)
    transpot.remove()
    let totalt = ($('#id_transport_heavy').val() - w).toFixed(3)
    console.log(totalt)
    $("#id_transport option[value="+ pk +"]").remove()
    $('#id_transport_heavy').val(totalt)
    $('#pesada').text((totalt.toString().replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1,$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ".")) + ' (TM) ')
    remanante()
}
deleteTransport

function totalUnloaded(){
    let dratinicial = (parseFloat($('#id_draft').val()))
    let draftfinal = parseFloat($('#final_draft').val())
    if (dratinicial > 0 && draftfinal >0 ){
        let totalUnloaded = 0
        if(orderType == 'descarga'){
            totalUnloaded = ((dratinicial - draftfinal).toFixed(3)).toString().replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1.$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ",")
            console.log(totalUnloaded)
        }else{
            totalUnloaded = ((draftfinal - dratinicial).toFixed(3)).toString().replace(/\D/g, "").replace(/([0-9])([0-9]{3})$/, '$1.$2').replace(/\B(?=(\d{3})+(?!\d)\.?)/g, ",")
            console.log(totalUnloaded)
        }
        $('#total-unloaded').text(totalUnloaded)
    }
}
totalUnloaded()



</script>
<script src="{% static 'vendors/typeahead.js/typeahead.bundle.min.js' %}"></script>
<script src="{% static 'vendors/select2/select2.min.js' %}"></script>
<script src="{% static 'js/typeahead.js' %}"></script>
<script src="{% static 'js/select2.js' %}"></script>


{% endblock %}
